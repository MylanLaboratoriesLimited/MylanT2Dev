(function(){function g(d){return("function"===typeof d?k:f)(d)}function k(d){return function(c){return d(c)===c}}function f(d){return function(c){return Object.keys(d).every(function(a){var b=d[a];return Array.isArray(b)?Array.isArray(c[a])&&c[a].every(g(b[0])):c.hasOwnProperty(a)&&g(b)(c[a])})}}window.schema=f})();
(function(){function g(a,b){Object.keys(a).forEach(function(e){a[e]=b[e]})}function k(a,b,e,d){var c=d.updateBy,f;c&&a[b].filter(function(a){return a[c]===e[c]}).forEach(function(a){f=!0;(d.update||g)(a,e)});f||a[b].push(e)}function f(){var a=localStorage.getItem("KPI"),a=a?JSON.parse(a):{};Object.keys(c).filter(function(b){return!a.hasOwnProperty(b)}).forEach(function(b){d[b].options.unique||(a[b]=[])});return a}var d={},c={};window.submit={data:function(a,b){var e=d[a],c=f();if(!e)throw Error('Unknown schema for "'+
a+'"');if(!e.validate(b))throw Error('Invalid data for "'+a+'": '+JSON.stringify(b));e.options.unique?c[a]=b:k(c,a,b,e.options);localStorage.setItem("KPI",JSON.stringify(c))},schema:function(a,b,e){d[a]={validate:schema(b),options:e||{}};d[a].options.unique||(c[a]=[])}}})();
(function(){function g(b){a=b.detail.startY<p}function k(){var a=h.current.slide.frame.contentDocument.querySelector("h1");c=Date.now();b=a?a.innerText:"";l=n.slides[h.current.slide.id].name||b||"";h.current.slide.frame.contentDocument.addEventListener("swipeleft",g);h.current.slide.frame.contentDocument.addEventListener("swiperight",g)}function f(){var b=Math.round((Date.now()-c)/1E3);l&&(l=l.replace(/<sup>(.*)<\/sup>/gi," ").replace(/<sub>(.*)<\/sub>/gi," ").replace(/<(.*?)>/gi," ").replace(/(\t)+/gi,
" ").replace(/\n/gi," ").trim());submit.data("slides",{id:e,name:l,time:b,chapter:m,likes:+a||0,presentation:""},!1);submit.data("chapter",{id:m,time:b})}function d(a,b){"slideenter"===b.type&&(e=h.current.slide.id,m=h.current.chapter.id);0===n.slides[e].major&&a()}var c,a,b,e,m,l,p=window.innerHeight/2,h=require("spa"),n=require("structure");e=h.current.slide.id;document.addEventListener("slideenter",d.bind(null,k));document.addEventListener("slideleave",d.bind(null,f));window.addEventListener("proceed",
d.bind(null,k));window.addEventListener("suspend",d.bind(null,f));submit.schema("slides",{id:String,name:String,time:Number,likes:Number,chapter:String,presentation:String},{updateBy:"id",update:function(a,b){a.time+=b.time}});submit.schema("chapter",{id:String,time:Number},{updateBy:"id",update:function(a,b){a.time+=b.time}})})();
